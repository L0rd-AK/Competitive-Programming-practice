┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                        FEDERATED HYBRID ENSEMBLE METHODOLOGY FLOWCHART                       │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────┐
│      DATA COLLECTION           │
│                                │
│  ┌──────────────────────────┐ │
│  │  HAM10000 Dataset        │ │
│  │  • 10,015 images         │ │
│  │  • 7 lesion types        │ │
│  │  • Lesion-level metadata │ │
│  └──────────────────────────┘ │
└───────────────┬────────────────┘
                │
                ▼
┌────────────────────────────────┐
│    DATA PREPROCESSING          │
│                                │
│  ┌──────────┬──────────┬─────┐│
│  │ Resize   │Normalize │Color││
│  │300×300   │HAM10000  │Jitter││
│  │pixels    │statistics│Flips ││
│  └──────────┴──────────┴─────┘│
│                                │
│  ┌──────────────────────────┐ │
│  │ Lesion-Level Splitting   │ │
│  │ 8,360 train / 827 val /  │ │
│  │ 828 test                 │ │
│  └──────────────────────────┘ │
└───────────────┬────────────────┘
                │
                ▼
┌────────────────────────────────┐
│   CLASS IMBALANCE HANDLING     │
│                                │
│  ┌──────────────────────────┐ │
│  │  RandomOverSampler       │ │
│  │  58:1 ratio → Balanced   │ │
│  │  37,660 samples          │ │
│  │  (5,380 per class)       │ │
│  └──────────────────────────┘ │
└───────────────┬────────────────┘
                │
                ▼
┌────────────────────────────────────────────────────────────────────┐
│               NON-IID DATA DISTRIBUTION                            │
│                                                                    │
│  ┌──────────────┐      ┌──────────────┐      ┌──────────────┐  │
│  │  Client 1    │      │  Client 2    │      │  Client 3    │  │
│  │  10,650      │      │  13,415      │      │  13,595      │  │
│  │  samples     │      │  samples     │      │  samples     │  │
│  │              │      │              │      │              │  │
│  │ Benign       │      │ Vascular     │      │ Melanocytic  │  │
│  │ keratosis    │      │ lesions      │      │ nevi         │  │
│  │ (40%)        │      │ (37%)        │      │ (38%)        │  │
│  │              │      │              │      │              │  │
│  │ Actinic      │      │ Melanoma     │      │ Basal cell   │  │
│  │ keratoses    │      │ (23%)        │      │ carcinoma    │  │
│  │ (28%)        │      │              │      │ (31%)        │  │
│  └──────┬───────┘      └──────┬───────┘      └──────┬───────┘  │
│         │                     │                     │          │
└─────────┼─────────────────────┼─────────────────────┼──────────┘
          │                     │                     │
          └─────────────────────┼─────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│              HYBRID ENSEMBLE ARCHITECTURE                            │
│                                                                      │
│  ┌──────────────────┐                    ┌──────────────────┐     │
│  │ EfficientNetB3   │                    │  InceptionV3     │     │
│  │                  │                    │                  │     │
│  │ • 1536 features  │                    │ • 2048 features  │     │
│  │ • Compound       │                    │ • Multi-scale    │     │
│  │   scaling        │                    │   parallel       │     │
│  │ • ImageNet       │                    │   filters        │     │
│  │   pretrained     │                    │   (1×1,3×3,5×5)  │     │
│  └────────┬─────────┘                    └────────┬─────────┘     │
│           │                                       │               │
│           │      ┌───────────────────────────────┘               │
│           │      │                                                │
│           ▼      ▼                                                │
│  ┌──────────────────────────────────────────┐                    │
│  │     FEATURE PROJECTION TO 512-DIM        │                    │
│  │     W_E ∈ ℝ^(512×1536)                  │                    │
│  │     W_I ∈ ℝ^(512×2048)                  │                    │
│  └──────────────────┬───────────────────────┘                    │
│                     │                                             │
│                     ▼                                             │
│  ┌──────────────────────────────────────────┐                    │
│  │     ATTENTION-BASED FUSION               │                    │
│  │                                          │                    │
│  │  a = Softmax(W₂·ReLU(W₁·[f'_E; f'_I]))  │                    │
│  │  f_ensemble = [a₁·f'_E; a₂·f'_I]        │                    │
│  │  Output: 1024-dimensional features       │                    │
│  └──────────────────┬───────────────────────┘                    │
│                     │                                             │
│                     ▼                                             │
│  ┌──────────────────────────────────────────┐                    │
│  │     CLASSIFICATION HEAD                  │                    │
│  │                                          │                    │
│  │  1024 → 512 → 256 → 7 classes           │                    │
│  │  • Dropout (0.5, 0.5, 0.25)             │                    │
│  │  • BatchNorm, ReLU                       │                    │
│  │  • CrossEntropyLoss                      │                    │
│  └──────────────────────────────────────────┘                    │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│           FEDERATED TRAINING PROTOCOL (FedAvg)                       │
│                                                                      │
│  FOR round = 1 to 10:                                               │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 1. SERVER BROADCASTS: θ_global → All Clients (9.6 MB)       │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 2. LOCAL TRAINING: Each client trains for 3 epochs          │  │
│  │    • AdamW optimizer (lr=1e-3, weight_decay=1e-4)            │  │
│  │    • ReduceLROnPlateau scheduler                             │  │
│  │    • Batch size: 32                                          │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 3. CLIENTS UPLOAD: θ_k → Server (28.8 MB)                   │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 4. SERVER AGGREGATION:                                       │  │
│  │    θ_global = Σ(n_k/n_total) × θ_k                          │  │
│  │    Weights: [0.283, 0.356, 0.361]                           │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  END FOR                                                             │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    MODEL EVALUATION                                  │
│                                                                      │
│  ┌──────────────────┬──────────────────┬──────────────────┐        │
│  │   Performance    │  ROC Analysis    │  Confusion       │        │
│  │   Metrics        │                  │  Matrix          │        │
│  │                  │                  │                  │        │
│  │ • Accuracy       │ • AUC: 0.90-1.00 │ • Per-class      │        │
│  │   93.00%         │ • Perfect 1.00:  │   errors         │        │
│  │                  │   Basal cell,    │ • Melanoma-nevi  │        │
│  │ • Precision      │   Vascular       │   confusion      │        │
│  │ • Recall         │                  │   (35%)          │        │
│  │ • F1-Score       │ • Near-perfect:  │                  │        │
│  │                  │   0.97-0.99      │ • 98% correct    │        │
│  │                  │                  │   Melanocytic    │        │
│  │                  │                  │   nevi           │        │
│  └──────────────────┴──────────────────┴──────────────────┘        │
└─────────────────────────┬───────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────┐
│              CLINICAL DEPLOYMENT (WEB APPLICATION)                   │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  USER INTERFACE                                              │  │
│  │  • Image upload (300×300 RGB)                                │  │
│  │  • Patient demographics input                                │  │
│  │  • Lesion characteristics                                    │  │
│  └──────────────────┬───────────────────────────────────────────┘  │
│                     │                                               │
│                     ▼                                               │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  PREDICTION PIPELINE                                         │  │
│  │  1. Preprocessing (0.3s)                                     │  │
│  │  2. Model inference (1.2s)                                   │  │
│  │  3. Softmax probabilities (0.3s)                             │  │
│  │  4. Confidence thresholding (70%)                            │  │
│  └──────────────────┬───────────────────────────────────────────┘  │
│                     │                                               │
│                     ▼                                               │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  RESULTS VISUALIZATION                                       │  │
│  │  • Top-3 predicted classes with probabilities                │  │
│  │  • Attention heatmaps (Grad-CAM)                             │  │
│  │  • Architecture contribution (EfficientNetB3 vs InceptionV3) │  │
│  │  • Flagged cases for dermatologist review                    │  │
│  └──────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
